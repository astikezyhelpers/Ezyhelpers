{% extends 'base.html' %}
{% load static %}

{% block title %}Contact Us | EzyHelpers{% endblock %}
{% block description %}Contact Us Page Description{% endblock %}

{% block content %}

{% if success %}
<div id="successPopup" class="fixed top-6 right-6 z-50 bg-green-100 border border-green-400 text-green-800 px-6 py-4 rounded-lg shadow-lg flex items-start gap-2 transition-all duration-300">
  <svg class="w-6 h-6 text-green-500 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M9 12l2 2 4-4m5 2a9 9 0 11-18 0 9 9 0 0118 0z" />
  </svg>
  <div class="flex-1">
    <strong class="font-semibold">Thank you!</strong>
    <p>You will get a call from our representative soon.</p>
  </div>
  <button onclick="document.getElementById('successPopup').remove()" class="ml-4 text-xl leading-none font-bold text-green-800 hover:text-green-600">&times;</button>
</div>
{% endif %}
  <!-- Hero Section -->
  <section class="px-8 relative h-[500px] flex items-center overflow-hidden pt-16">
    <div class="absolute inset-0 overflow-hidden z-0">
      <div class="absolute inset-0 bg-gradient-to-br from-primary/20 via-white to-secondary/20 opacity-70 z-10"></div>
      <div class="absolute top-0 left-0 w-full h-full bg-[url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80')] bg-cover bg-center animate-tilt"></div>
      <div class="absolute inset-0 bg-gradient-to-t from-dark/70 via-dark/30 to-transparent z-10"></div>
    </div>
    <div class="container mx-auto px-4 lg:px-6 relative z-20 text-center">
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold font-heading mb-6 leading-tight text-white" data-aos="fade-up">
        <span class="bg-clip-text text-transparent bg-gradient-to-r from-white to-secondary/80">Contact Us</span>
      </h1>
      <p class="text-lg sm:text-xl text-gray-200 max-w-3xl mx-auto" data-aos="fade-up" data-aos-delay="200">
        We're here to assist you with all your domestic help needs. Reach out to us anytime, and let's find the perfect solution for your family.
      </p>
    </div>
  </section>

  <!-- Contact Form Section (Multiple Options) -->
  <section class="px-8 py-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center max-w-3xl mx-auto mb-16" data-aos="fade-up">
        <span class="inline-block px-4 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium mb-3">GET IN TOUCH</span>
        <h2 class="text-3xl md:text-4xl font-bold font-heading mb-4">Send Us a Message</h2>
        <p class="text-gray-600">Fill out the form below, and our team will get back to you within 2 hours during business hours.</p>
      </div>

      <!-- Option 1: Simple Contact Form -->
      <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-8 mb-12" data-aos="fade-up">
        <form method="POST" action="{% url 'contact_us' %}" class="space-y-6" id="contactUsForm">
          {% csrf_token %}
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-1" for="full-name">Full Name</label>
            <input type="text" placeholder="Enter your name" name="full-name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
          </div>
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-1" for="email">Email Address</label>
            <input type="email" placeholder="Enter your email" name="email" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
          </div>
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-1" for="phone">Phone Number</label>
            <input type="number" placeholder="Enter your phone" name="phone" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300">
          </div>
          <div>
            <label class="block text-gray-700 text-sm font-medium mb-1" for="message">Message</label>
            <textarea placeholder="Tell us how we can help" rows="5" name="message" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all duration-300"></textarea>
          </div>
          <button type="submit" class="w-full bg-gradient-to-r from-primary to-primary/90 text-white py-3 px-4 rounded-lg font-medium hover:from-primary/90 hover:to-primary transition-all duration-300 shadow-md hover:shadow-lg">
            Send Message
          </button>
        </form>
        <div id="contactFormMessage" class="mt-4"></div>
      </div>
    </div>
  </section>

  <!-- Contact Info Section (Multiple Options) -->
  <section class="px-8 py-20 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="text-center max-w-3xl mx-auto mb-16" data-aos="fade-up">
        <span class="inline-block px-4 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium mb-3">REACH US</span>
        <h2 class="text-3xl md:text-4xl font-bold font-heading mb-4">Contact Information</h2>
        <p class="text-gray-600">We're available 24/7 to assist you. Choose your preferred way to get in touch.</p>
      </div>

      <!-- Option 1: Card Layout -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto mb-12" data-aos="fade-up">
        <div class="bg-white rounded-2xl shadow-lg p-8 text-center hover:shadow-xl transition-all duration-500">
          <div class="bg-primary/10 text-primary w-14 h-14 rounded-full flex items-center justify-center text-2xl mx-auto mb-4">
            <i class="fas fa-phone"></i>
          </div>
          <h3 class="text-xl font-bold font-heading mb-2">Phone</h3>
          <p class="text-gray-600">(+91) 99725 - 71005</p>
          <p class="text-sm text-gray-500 mt-2">Available 9AM-5PM(Mon-Fri)</p>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-8 text-center hover:shadow-xl transition-all duration-500">
          <div class="bg-primary/10 text-primary w-14 h-14 rounded-full flex items-center justify-center text-2xl mx-auto mb-4">
            <i class="fas fa-envelope"></i>
          </div>
          <h3 class="text-xl font-bold font-heading mb-2">Email</h3>
          <p class="text-gray-600">contact@ezyhelpers.com</p>
          <p class="text-sm text-gray-500 mt-2">Response within 2 hours</p>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-8 text-center hover:shadow-xl transition-all duration-500">
          <div class="bg-primary/10 text-primary w-14 h-14 rounded-full flex items-center justify-center text-2xl mx-auto mb-4">
            <i class="fas fa-map-marker-alt"></i>
          </div>
          <h3 class="text-xl font-bold font-heading mb-2">Office</h3>
          <p class="text-gray-600">Sarjapur Road, Near Motherhood Hospital, Bangalore 560035, India</p>
          <p class="text-sm text-gray-500 mt-2">Mon-Fri: 9 AM - 5 PM</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Map Section (Multiple Options) -->
  <section class="px-8 py-20 bg-white">
    <div class="container mx-auto px-4">
      <div class="text-center max-w-3xl mx-auto mb-16" data-aos="fade-up">
        <span class="inline-block px-4 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium mb-3">FIND US</span>
        <h2 class="text-3xl md:text-4xl font-bold font-heading mb-4">Our Location</h2>
        <p class="text-gray-600">Visit our office or see where we're based to serve you better.</p>
      </div>

      <!-- Option 1: Embedded Google Map -->
      <div class="max-w-5xl mx-auto mb-12" data-aos="fade-up">
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3889.108937403741!2d77.6479017746028!3d12.900716116429415!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3bae13cc6492dd4b%3A0xfcddb39c37ce09e6!2sEzyHelpers!5e0!3m2!1sen!2sin!4v1744188319121!5m2!1sen!2sin"                  width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </div>
  </section>
  <script src="{% static 'js/formSubmit.js' %}"></script>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Give the form this ID: id="contactUsForm"
    const contactForm = document.getElementById('contactUsForm'); 
    // Add an empty div near the form for messages: <div id="contactFormMessage" class="mt-4"></div>
    const messageContainer = document.getElementById('contactFormMessage'); 

    if (contactForm && messageContainer) {
        contactForm.addEventListener('submit', function(event) {
            event.preventDefault(); 

            const formData = new FormData(contactForm);
            const submitButton = contactForm.querySelector('button[type="submit"]');
             // Ensure the button has type="submit"
            if (!submitButton) {
                console.error("Submit button not found in form:", contactForm);
                return;
            }
            const originalButtonText = submitButton.innerHTML;

            submitButton.disabled = true;
            submitButton.innerHTML = 
                `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Sending...`;

            messageContainer.innerHTML = '';
            messageContainer.className = ''; 

            fetch(contactForm.action || window.location.pathname, { 
                method: 'POST',
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'), 
                    'X-Requested-With': 'XMLHttpRequest', 
                },
                body: formData 
            })
            .then(response => {
                 const contentType = response.headers.get("content-type");
                 if (contentType && contentType.indexOf("application/json") !== -1) {
                    return response.json().then(data => ({ ok: response.ok, status: response.status, data }));
                 } else {
                    return response.text().then(text => { throw new Error(`Server returned non-JSON response: ${response.status} ${response.statusText}. Body: ${text.substring(0, 100)}`); });
                 }
            })
            .then(result => {
                 if (!result.ok) {
                    throw new Error(result.data.error || `Server error: ${result.status}`);
                 }
                 const data = result.data;
                 if (data.success) {
                    messageContainer.innerHTML = 
                        `<div class="bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded-md relative" role="alert"><strong class="font-bold">Success!</strong><span class="block sm:inline"> Message sent successfully. We will get back to you soon.</span></div>`;
                    messageContainer.className = 'mt-6 mb-6'; // Add vertical margin

                    const thankYouUrl = new URL('{% url "thank_you" %}', window.location.origin);
                    // Use the specific keys from the form_data returned by the contact_us view (Name, Email, Phone, Message)
                    const thankYouData = {
                         Name: data.form_data.Name, // Match case from view
                         Email: data.form_data.Email,
                         Phone: data.form_data.Phone,
                         Message: data.form_data.Message,
                         form_type: 'Contact Us Page'
                    };
                    for (const key in thankYouData) {
                         if (thankYouData[key]) {
                            thankYouUrl.searchParams.append(key, thankYouData[key]);
                         }
                    }
                    window.open(thankYouUrl.toString(), '_blank');
                    contactForm.reset();
                 } else {
                    messageContainer.innerHTML = 
                        `<div class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-md relative" role="alert"><strong class="font-bold">Error!</strong><span class="block sm:inline"> ${data.error || 'Could not send message. Please try again.'}</span></div>`;
                    messageContainer.className = 'mt-6 mb-6';
                 }
            })
            .catch(error => {
                console.error('Contact form submission error:', error);
                 messageContainer.innerHTML = 
                    `<div class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-md relative" role="alert"><strong class="font-bold">Error!</strong><span class="block sm:inline"> An unexpected error occurred: ${error.message}. Please try again later.</span></div>`;
                 messageContainer.className = 'mt-6 mb-6';
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            });
        });
    } else {
        if (!contactForm) console.error("Contact form with ID 'contactUsForm' not found.");
        if (!messageContainer) console.error("Contact message container with ID 'contactFormMessage' not found.");
    }
});
</script>
{% endblock %}